{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-jsx","path":"/posts/2021-02-04-react-markdown-rendering/","result":{"data":{"markdownRemark":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{"id":"Rendering-Markdown-in-ReactJS","style":"position:relative;"},"children":[{"type":"text","value":"Rendering Markdown in ReactJS"},{"type":"element","tagName":"a","properties":{"href":"#Rendering-Markdown-in-ReactJS","ariaLabel":"Rendering Markdown in ReactJS permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This post will take you through my process of creating this markdown renderer you're seeing right now for Markdown."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"My aim is to render each Markdown component cleanly in HTML and have "},{"type":"element","tagName":"span","properties":{"className":["math","math-inline"]},"children":[{"type":"element","tagName":"span","properties":{"className":["katex"]},"children":[{"type":"element","tagName":"span","properties":{"className":["katex-mathml"]},"children":[{"type":"element","tagName":"math","properties":{"xmlns":"http://www.w3.org/1998/Math/MathML"},"children":[{"type":"element","tagName":"semantics","properties":{},"children":[{"type":"element","tagName":"mrow","properties":{},"children":[{"type":"element","tagName":"mtext","properties":{},"children":[{"type":"text","value":"LaTeX"}]}]},{"type":"element","tagName":"annotation","properties":{"encoding":"application/x-tex"},"children":[{"type":"text","value":"\\LaTeX"}]}]}]}]},{"type":"element","tagName":"span","properties":{"className":["katex-html"],"ariaHidden":"true"},"children":[{"type":"element","tagName":"span","properties":{"className":["base"]},"children":[{"type":"element","tagName":"span","properties":{"className":["strut"],"style":"height:0.89883em;vertical-align:-0.2155em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["mord","text"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mord","textrm"]},"children":[{"type":"text","value":"L"}]},{"type":"element","tagName":"span","properties":{"className":["mspace"],"style":"margin-right:-0.36em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["vlist-t"]},"children":[{"type":"element","tagName":"span","properties":{"className":["vlist-r"]},"children":[{"type":"element","tagName":"span","properties":{"className":["vlist"],"style":"height:0.68333em;"},"children":[{"type":"element","tagName":"span","properties":{"style":"top:-2.904999em;"},"children":[{"type":"element","tagName":"span","properties":{"className":["pstrut"],"style":"height:2.7em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["mord"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mord","textrm","mtight","sizing","reset-size6","size3"]},"children":[{"type":"text","value":"A"}]}]}]}]}]}]},{"type":"element","tagName":"span","properties":{"className":["mspace"],"style":"margin-right:-0.15em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["mord","text"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mord","textrm"]},"children":[{"type":"text","value":"T"}]},{"type":"element","tagName":"span","properties":{"className":["mspace"],"style":"margin-right:-0.1667em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["vlist-t","vlist-t2"]},"children":[{"type":"element","tagName":"span","properties":{"className":["vlist-r"]},"children":[{"type":"element","tagName":"span","properties":{"className":["vlist"],"style":"height:0.46782999999999997em;"},"children":[{"type":"element","tagName":"span","properties":{"style":"top:-2.7845em;"},"children":[{"type":"element","tagName":"span","properties":{"className":["pstrut"],"style":"height:3em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["mord"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mord","textrm"]},"children":[{"type":"text","value":"E"}]}]}]}]},{"type":"element","tagName":"span","properties":{"className":["vlist-s"]},"children":[{"type":"text","value":"â€‹"}]}]},{"type":"element","tagName":"span","properties":{"className":["vlist-r"]},"children":[{"type":"element","tagName":"span","properties":{"className":["vlist"],"style":"height:0.2155em;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"element","tagName":"span","properties":{"className":["mspace"],"style":"margin-right:-0.125em;"},"children":[]},{"type":"element","tagName":"span","properties":{"className":["mord","textrm"]},"children":[{"type":"text","value":"X"}]}]}]}]}]}]}]},{"type":"text","value":" renderering."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For your ease of access, here are links to my code"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/dustbringer/dustbringer.github.io/blob/main/src/components/Markdown.jsx"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"<Markdown />"}]},{"type":"text","value":" component"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/dustbringer/dustbringer.github.io/tree/main/src/components/mdRenderers"},"children":[{"type":"text","value":"Custom renderers"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/dustbringer/dustbringer.github.io/blob/main/src/components/MarkdownContents.jsx"},"children":[{"type":"text","value":"Navigatible Contents component"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Foundation","style":"position:relative;"},"children":[{"type":"text","value":"Foundation"},{"type":"element","tagName":"a","properties":{"href":"#Foundation","ariaLabel":"Foundation permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will be using the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/remarkjs/react-markdown"},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" module that is based on "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/remarkjs/remark"},"children":[{"type":"text","value":"remark"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"remark"}]},{"type":"text","value":" is a Markdown processor built on micromark powered by plugins part of the unified collective."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Installing the module is straightfoward"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"npm install react-markdown\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"yarn add react-markdown\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, the wrapper for the Markdown rendering component will be taken straight from "},{"type":"element","tagName":"a","properties":{"href":"https://levelup.gitconnected.com/adding-katex-and-markdown-in-react-7b70694004ef"},"children":[{"type":"text","value":"this"}]},{"type":"text","value":" helpful guide."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"Variation","style":"position:relative;"},"children":[{"type":"text","value":"Variation"},{"type":"element","tagName":"a","properties":{"href":"#Variation","ariaLabel":"Variation permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"From the tutorial link above, there are some changes that I made for my purposes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"Wrapping-div","style":"position:relative;"},"children":[{"type":"text","value":"Wrapping "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"div"}]},{"type":"element","tagName":"a","properties":{"href":"#Wrapping-div","ariaLabel":"Wrapping div permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I am using Google's MaterialUI to replace the traditional HTML components in many places, so the fonts rendered by primitive HTML tags are default. So we wrap the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"<ReactMarkdown />"}]},{"type":"text","value":" component with a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"div"}]},{"type":"text","value":" with our new fonts and colors, so everything displayed will be consistent."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"Remark-Plugins","style":"position:relative;"},"children":[{"type":"text","value":"Remark Plugins"},{"type":"element","tagName":"a","properties":{"href":"#Remark-Plugins","ariaLabel":"Remark Plugins permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" package is made by "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remark"}]},{"type":"text","value":", it supports some of the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remark"}]},{"type":"text","value":" plugins. Not all of the plugins work, from my trial and error, it seems like we can only use ones that do not directly change the source Markdown."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is a chonky list of plugins "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/remarkjs/remark/blob/main/doc/plugins.md"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" but I have used "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remark-math"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remark-gfm"}]},{"type":"text","value":", and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remark-frontmatter"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You will need to install the packages through "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":", import them into the component we are working on, and add them to the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"props"}]},{"type":"text","value":" as"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"{\r\n  // ...\r\n  plugins: [\r\n    RemarkMathPlugin\r\n  ],\r\n  // ...\r\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"Math-renderer","style":"position:relative;"},"children":[{"type":"text","value":"Math renderer"},{"type":"element","tagName":"a","properties":{"href":"#Math-renderer","ariaLabel":"Math renderer permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The basic "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-katex"}]},{"type":"text","value":" package is old and throws some warnings in the newest React versions (17.0.1 at the time of writing). So instead use "},{"type":"element","tagName":"a","properties":{"href":"https://www.npmjs.com/package/@matejmazur/react-katex"},"children":[{"type":"text","value":"@matejmazur/react-katex"}]},{"type":"text","value":" which includes many "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/talyssonoc/react-katex/issues/49"},"children":[{"type":"text","value":"improvements"}]},{"type":"text","value":" over the original "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-katex"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After installing and importing, the two math renderers will need to be changed as follows"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"{\r\n  // ...\r\n  math: ({ value }) => <TeX block>{value}</TeX>,\r\n  inlineMath: ({ value }) => <TeX>{value}</TeX>,\r\n  // ...\r\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"More-custom-renderers","style":"position:relative;"},"children":[{"type":"text","value":"More custom renderers"},{"type":"element","tagName":"a","properties":{"href":"#More-custom-renderers","ariaLabel":"More custom renderers permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"See the next section."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Custom-Renderers","style":"position:relative;"},"children":[{"type":"text","value":"Custom Renderers"},{"type":"element","tagName":"a","properties":{"href":"#Custom-Renderers","ariaLabel":"Custom Renderers permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now everthing is rendered in very basic HTML (e.g. "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"p"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"h1"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"h2"}]},{"type":"text","value":", ...) without any styling, so its not too pleasing to the eye. Fortunately we can write our own custom renderers to replace the default ones."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can add them into the props, for example code blocks"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"renderers: {\r\n    ...props.renderers,\r\n    code: BlockCodeRenderer,\r\n    // ...\r\n  },\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"we need a component that will replace the default "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"<code>"}]},{"type":"text","value":" tags."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can find the default renderers and their implementations in the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/remarkjs/react-markdown/blob/main/src/renderers.js"},"children":[{"type":"text","value":"git repo"}]},{"type":"text","value":". This will tell us the name of the part to be rendered and how information is passed around behind the scenes in the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" component."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With this starting point, we can see what props are passed to each component and write our own components with custom styling that can render similarly to the original."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some more inspiration:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/robinweser/react-markdown-github-renderers"},"children":[{"type":"text","value":"Custom renderers by robinweser"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/dustbringer/dustbringer.github.io/tree/main/src/components/mdRenderers"},"children":[{"type":"text","value":"The renderers that I wrote"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Anchors-removed","style":"position:relative;"},"children":[{"type":"text","value":"Anchors (removed)"},{"type":"element","tagName":"a","properties":{"href":"#Anchors-removed","ariaLabel":"Anchors removed permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Taking inspiration from Github's and HackMD's Markdown viewer (along with many other sites that have anchors), I tried to tackle the links to headings on the rendered Markdown."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The little link icon that showed up as you hover over the link, was simple enough. So the difficult part is dealing with the url."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"My website will be hosted on GitHub Pages, where you are forced to use "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-router"}]},{"type":"text","value":"'s "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"HashRouter"}]},{"type":"text","value":" for routing. Thus, the classic \"just link to a hash with the same id as the heading\" will not work, and we must resort to another method of storing the heading and scrolling."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To solve the problem of not having the hash part of the URL available, I used the 'search' part of the url to store that data. To scroll, we use React's "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"useRef()"}]},{"type":"text","value":" hook (by "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref.current.scrollIntoView()"}]},{"type":"text","value":") to scroll to the correct heading, when the URL search query matches up."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"However, to avoid having to store all the refs in some Global Storage, I run a comparison between the URL search query and the heading's unique name for each heading as it loads in."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Since the search query only matches to a unique heading, it will be scrolled to with its "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"How-do-we-generate-these-unique-names","style":"position:relative;"},"children":[{"type":"text","value":"How do we generate these unique names?"},{"type":"element","tagName":"a","properties":{"href":"#How-do-we-generate-these-unique-names","ariaLabel":"How do we generate these unique names permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Take the heading content, then run some regex to remove non-alphanumeric characters and replace whitespace. Some of the following is taken and inspired by "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/remarkjs/react-markdown/issues/69"},"children":[{"type":"text","value":"replies here"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Get the heading content,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function flatten(text, child) {\r\n  return typeof child === \"string\"\r\n    ? text + child\r\n    : React.Children.toArray(child.props.children).reduce(flatten, text);\r\n}\r\n\r\n// Get text in children\r\nconst children = React.Children.toArray(props.children);\r\nconst text = children.reduce(flatten, \"\");\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"then strip the bad characters"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"text\r\n  .toLowerCase()\r\n  .replace(/[^0-9A-Z\\s]+/gi, \"\")\r\n  .replace(/\\W/g, \"-\")\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"and store an incrementing id outside the functional commponent to keep the generated names unique."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"Problems","style":"position:relative;"},"children":[{"type":"text","value":"Problems"},{"type":"element","tagName":"a","properties":{"href":"#Problems","ariaLabel":"Problems permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now after adding an initial scroll to a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref"}]},{"type":"text","value":" if a URL query is present (using the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"useEffect()"}]},{"type":"text","value":" hook) everything seems to be working fine. However, on first load of a webpage (without caching), some further titles do not get scrolled to the top of the screen."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The cause is not immediately apparent to me, but it seems to be due to components that have not rendered before the scrolling starts."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Without further rewriting the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" module, I decide to abandon the idea in favor of something more practical..."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Contents-List","style":"position:relative;"},"children":[{"type":"text","value":"Contents List"},{"type":"element","tagName":"a","properties":{"href":"#Contents-List","ariaLabel":"Contents List permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Taking inspiration from HackMD's markdown previewer (and ontop of the failed framework of the anchors), I wrote a component that renders a contents table which can be used for navigation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since the inner workings of "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" is hidden from us, I used a janky workaround. It involves storing the heading "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref"}]},{"type":"text","value":"s from the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Anchors"}]},{"type":"text","value":" attempt in Global State and using them as links to scroll the user around."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this to work, I had to trust that all the headings rendered in the correct order, and displayed the list of "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref"}]},{"type":"text","value":"s and headings on the side with links that scrolls the heading into view. The scrolling, again, is handed by React's "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ref.current.scrollIntoView()"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Conclusion","style":"position:relative;"},"children":[{"type":"text","value":"Conclusion"},{"type":"element","tagName":"a","properties":{"href":"#Conclusion","ariaLabel":"Conclusion permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It was very insightful and interesting experience digging into "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ReactMarkdown"}]},{"type":"text","value":" and reworking its innards to acheive my view of an \"OKAY\" markdown renderer. Even if some additions were inefficient or work-aroundy to keep ReactMarkdown from falling apart, I still learnt lots about React best practices, components and how they use their props."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"Appendix-Helpful-Sources","style":"position:relative;"},"children":[{"type":"text","value":"(Appendix) Helpful Sources"},{"type":"element","tagName":"a","properties":{"href":"#Appendix-Helpful-Sources","ariaLabel":"Appendix Helpful Sources permalink","className":["header-link-class","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"20","version":"1.1","viewBox":"0 0 16 16","width":"20"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some websites that got me started,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://levelup.gitconnected.com/adding-katex-and-markdown-in-react-7b70694004ef"},"children":[{"type":"text","value":"https://levelup.gitconnected.com/adding-katex-and-markdown-in-react-7b70694004ef"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/42928530/how-do-i-load-a-markdown-file-into-a-react-component"},"children":[{"type":"text","value":"https://stackoverflow.com/questions/42928530/how-do-i-load-a-markdown-file-into-a-react-component"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"frontmatter":{"date":"04 February 2021","edited":"04 February 2021","slug":"/posts/2021-02-04-React-Markdown-Rendering","title":"Rendering Markdown in ReactJS","author":"dustbringer"},"headings":[{"depth":1,"id":"Rendering-Markdown-in-ReactJS","value":"Rendering Markdown in ReactJS"},{"depth":2,"id":"Foundation","value":"Foundation"},{"depth":3,"id":"Variation","value":"Variation"},{"depth":4,"id":"Wrapping-div","value":"Wrapping div"},{"depth":4,"id":"Remark-Plugins","value":"Remark Plugins"},{"depth":4,"id":"Math-renderer","value":"Math renderer"},{"depth":4,"id":"More-custom-renderers","value":"More custom renderers"},{"depth":2,"id":"Custom-Renderers","value":"Custom Renderers"},{"depth":2,"id":"Anchors-removed","value":"Anchors (removed)"},{"depth":3,"id":"How-do-we-generate-these-unique-names","value":"How do we generate these unique names?"},{"depth":3,"id":"Problems","value":"Problems"},{"depth":2,"id":"Contents-List","value":"Contents List"},{"depth":2,"id":"Conclusion","value":"Conclusion"},{"depth":2,"id":"Appendix-Helpful-Sources","value":"(Appendix) Helpful Sources"}]}},"pageContext":{"id":"02356c2e-6bad-5f06-baae-794d8fa61abe","frontmatter__slug":"/posts/2021-02-04-React-Markdown-Rendering","__params":{"frontmatter__slug":"posts"}}},"staticQueryHashes":[]}